CMAKE_MINIMUM_REQUIRED(VERSION 2.4 FATAL_ERROR)

PROJECT(hashkat-lib CXX)

#IF(WIN32)
#    SET(USERLIB_PREFIX_DEFAULT "c:/local")
#ELSE(WIN32)
#    SET(USERLIB_PREFIX_DEFAULT "/usr")
#ENDIF(WIN32)

#IF(WIN32)
#    SET(BOOST_PREFIX_DEFAULT "c:/Program Files/Boost")
#    OPTION(BOOST_DYNAMIC "Link to boost DLLs (OFF means static link)" OFF)
#ELSE(WIN32)
#    SET(BOOST_PREFIX_DEFAULT ${USERLIB_PREFIX})
#ENDIF(WIN32)

#INCLUDE(cmake/HkFindBoost.txt)

#INCLUDE_DIRECTORIES(${BOOST_INCLUDE_DIRS})
#LINK_DIRECTORIES(${BOOST_LIB_DIRS})

IF(NOT CMAKE_BUILD_TYPE)
SET(CMAKE_BUILD_TYPE RelWithDebInfo CACHE STRING
    "Choose the type of build, options are: None Debug Release RelWithDebInfo MinSizeRel."
    FORCE)
ENDIF(NOT CMAKE_BUILD_TYPE)

IF(MSVC)
    ADD_DEFINITIONS(-D_CRT_SECURE_NO_WARNINGS -D_SCL_SECURE_NO_WARNINGS)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /EHa /bigobj")
ELSE(MSVC)
    INCLUDE(CheckCXXCompilerFlag)
    CHECK_CXX_COMPILER_FLAG("-std=c++11" COMPILER_SUPPORTS_CXX11)
    CHECK_CXX_COMPILER_FLAG("-std=c++0x" COMPILER_SUPPORTS_CXX0X)
    IF(COMPILER_SUPPORTS_CXX11)
        SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")
    ELSEIF(COMPILER_SUPPORTS_CXX0X)
        SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++0x")
    ELSE()
            MESSAGE(STATUS "The compiler ${CMAKE_CXX_COMPILER} has no C++11 support. Please use a different C++ compiler.")
    ENDIF()
ENDIF()

OPTION(CONCURRENT "Build concurrent version of hashkat-lib usning threads?" OFF)
IF(CONCURRENT)
    OPTION(TRY_FINDING_INTEL_TBB "Try finding Intel TBB library ?" OFF)
    SET(TBB_FOUND FALSE)
    IF(TRY_FINDING_INTEL_TBB)
        IF(WIN32)
            SET(TBB_PREFIX "C:/local/tbb44_20150728oss")
        ELSE(WIN32)
            SET(TBB_PREFIX "$ENV{HOME}/tbb44_20150728oss")
        ENDIF(WIN32)
        INCLUDE(cmake/HkFindIntelTbb.txt)
        IF(TBB_FOUND)
            INCLUDE_DIRECTORIES(BEFORE SYSTEM ${TBB_INCLUDE_DIR})
        ELSE(TBB_FOUND)
            MESSAGE("-- Couldn't find Intel TBB library.")
        ENDIF(TBB_FOUND)
    ENDIF(TRY_FINDING_INTEL_TBB)
ENDIF(CONCURRENT)

OPTION(INSTALL_HEADERS "Install header files ?" OFF)
IF(INSTALL_HEADERS)
    FILE(COPY "include" DESTINATION ".")
ENDIF(INSTALL_HEADERS)

OPTION(BUILD_TESTS "Build and install all unit tests ?" OFF)
IF(BUILD_TESTS)
    OPTION(COPY_PATTERNS "Copy pattern files for unit tests ?" OFF)
    ADD_SUBDIRECTORY(test)
ENDIF(BUILD_TESTS)

ADD_SUBDIRECTORY(src)
